<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QT Real Trading</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:Arial,sans-serif;background:#0a1628;color:#fff;direction:rtl;display:flex;flex-direction:column;font-size:12.6px}
:root{--bg-card:#101a2f;--bg-secondary:#0d1117;--bg-overlay:rgba(10,22,40,.92);--border-primary:rgba(255,255,255,.10);--border-secondary:#1f2937;--text-primary:#fff;--accent-blue:#4299e1}
.header{flex:0 0 auto;display:flex;justify-content:space-between;align-items:center;padding:4px 10px;background:#0f1d35;position:relative}
.header::after{content:'';position:absolute;bottom:-8px;left:0;right:0;height:8px;background:linear-gradient(to bottom,#0f1d35,transparent);pointer-events:none;z-index:5}
.header-left{display:flex;gap:8px;align-items:center}
.header-center{display:flex;gap:8px;align-items:center}
.header-right{display:flex;align-items:center;gap:8px}
.icon-btn{width:38px;height:38px;background:rgba(255,255,255,.05);border-radius:8px;display:flex;align-items:center;justify-content:center;border:0;cursor:pointer;padding:0}
.logo-btn img{width:100%;height:100%;display:block;object-fit:cover}
.balance{display:flex;align-items:center;gap:7px;background:linear-gradient(135deg,var(--bg-card) 0%,var(--bg-secondary) 100%);border:1.5px solid var(--border-primary);border-radius:12px;padding:8px 12px;cursor:pointer;position:relative;transition:.2s;box-shadow:0 4px 12px rgba(0,0,0,.4);z-index:2601;min-width:190px}
.balanceMain{display:flex;align-items:center;gap:7px;flex:1;min-width:0}
.balance-amount{font-size:15px;font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#fff}
.arrow-down{width:14px;height:14px;margin-right:2px;transition:transform .2s;flex-shrink:0}
.balance.open .arrow-down{transform:rotate(180deg)}
.flag-icon{width:20px;height:14px;border-radius:3px;box-shadow:0 2px 4px rgba(0,0,0,.3)}
.accMenu{position:fixed;top:58px;right:8px;width:250px;background:linear-gradient(145deg,var(--bg-card) 0%,var(--bg-secondary) 100%);border:2px solid var(--border-primary);border-radius:16px;box-shadow:0 12px 32px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,.05) inset;padding:10px;z-index:99999;display:none}
.accMenu.show{display:block}
/* ‚îÄ‚îÄ ÿØŸàÿßÿ¶ÿ± ÿßŸÑÿ±ÿßÿØŸäŸà ‚îÄ‚îÄ */
.accCircle{width:19px;height:19px;border-radius:50%;border:2.5px solid rgba(255,255,255,.25);flex-shrink:0;transition:all .2s;background:transparent}
.accCircle.sel{background:#4299e1;border-color:#4299e1;box-shadow:0 0 10px rgba(66,153,225,.6)}
/* ‚îÄ‚îÄ ÿπŸÜÿµÿ± ÿßŸÑÿ≠ÿ≥ÿßÿ® ‚îÄ‚îÄ */
.accItem{background:rgba(255,255,255,.03);border:1.3px solid var(--border-primary);border-radius:12px;padding:10px 12px;margin-bottom:8px;cursor:pointer;transition:.15s;display:flex;align-items:center;justify-content:space-between;gap:8px}
.accItem.active{background:linear-gradient(135deg,rgba(66,153,225,.15) 0%,rgba(49,130,206,.1) 100%);border-color:var(--accent-blue);box-shadow:0 0 12px rgba(66,153,225,.2)}
.accL{display:flex;align-items:center;gap:10px;min-width:0;flex:1}
.accIco{width:22px;height:22px;object-fit:contain;filter:drop-shadow(0 2px 4px rgba(0,0,0,.4));border-radius:4px}
.accAmt{font-size:15px;font-weight:900;color:#fff;white-space:nowrap}
/* ‚îÄ‚îÄ ÿµŸÅ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ŸàÿßŸÑÿ™ÿπÿ®ÿ¶ÿ© ‚îÄ‚îÄ */
.refillRow{display:flex;gap:6px;margin:0 0 8px}
.switchBtn{flex:1;background:rgba(255,255,255,.07);border:1.5px solid rgba(255,255,255,.18);border-radius:9px;padding:8px 5px;font-size:10px;font-weight:900;color:#fff;cursor:pointer;transition:.15s}
.switchBtn:hover{background:rgba(255,255,255,.13)}
.refillBtnEl{flex:1;background:linear-gradient(135deg,#4299e1,#3182ce);border:0;border-radius:9px;padding:8px 5px;font-size:10px;font-weight:900;color:#fff;cursor:pointer;box-shadow:0 3px 10px rgba(66,153,225,.35);transition:.15s}
.refillBtnEl:active{transform:scale(.96)}
/* ‚îÄ‚îÄ avatar nav ‚îÄ‚îÄ */
.nav-avatar{width:22px;height:22px;border-radius:50%;object-fit:cover;border:1.5px solid rgba(255,255,255,.25)}
.wallet-btn{width:38px;height:38px;background:#16a34a;border-radius:8px;border:2px solid rgba(255,255,255,.15);cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0;overflow:hidden}
.wallet-btn img{width:100%;height:100%;display:block;object-fit:cover}
.time-display{position:absolute;left:8px;top:calc(100% + 8px);font-size:11px;color:#8b9cb5;font-weight:700;letter-spacing:.4px;background:rgba(15,29,53,.95);padding:6px 12px;border-radius:6px;z-index:180;border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;gap:6px}
.time-display::before{content:'';width:6px;height:6px;background:#0f0;border-radius:50%;box-shadow:0 0 8px #0f0;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.chart-container{flex:1 1 auto;min-height:0;background:#0a1628;position:relative;overflow:hidden}
.quick-actions{position:absolute;top:52px;left:8px;display:flex;flex-direction:column;gap:6px;z-index:190;pointer-events:none}
.quick-actions button{pointer-events:auto}
.qa-btn{width:44px;height:44px;background:#0f1d35;border:1px solid rgba(255,255,255,.12);border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0;cursor:pointer;transition:background .15s}
.qa-btn:hover{background:#1a2942}
.qa-btn:active{background:#213554}
.chart-frame{position:relative;width:100%;height:100%;overflow:hidden}
.plot{position:absolute;inset:0;overflow:hidden}
#chartCanvas{display:block;position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;touch-action:none;cursor:grab}
#chartCanvas:active{cursor:grabbing}
.candle-timer{position:absolute;color:rgba(255,255,255,.35);font-size:11px;font-weight:700;z-index:180;pointer-events:none;font-family:monospace}
.price-line{position:absolute;left:0;right:0;height:2px;background:transparent;z-index:150;pointer-events:none;border-top:2px dashed rgba(255,255,255,.7)}
.timeLabels{position:absolute;left:0;right:0;bottom:0;height:24px;background:rgba(10,22,40,.95);border-top:1px solid rgba(255,255,255,.08);pointer-events:none;z-index:160}
.timeLabel{position:absolute;bottom:2px;font-size:8.5px;font-weight:900;color:rgba(255,255,255,.55);transform:translateX(-50%);white-space:nowrap}
.timeLabel.major{color:rgba(255,215,0,.85);font-weight:900}
#priceScale{position:absolute;top:0;right:0;bottom:0;width:50px;pointer-events:none;z-index:170;background:transparent!important;border:none!important;box-shadow:none!important}
#priceScaleLabels{position:absolute;inset:0;background:transparent!important;border:none!important;box-shadow:none!important}
#currentPrice{position:absolute;right:8px;transform:translateY(-50%);color:#000;font-size:10px;font-weight:900;white-space:nowrap;background:#ffd700!important;padding:4px 8px!important;border-radius:4px!important;box-shadow:0 0 10px rgba(255,215,0,.6)!important;text-shadow:none!important;border:1px solid rgba(255,215,0,.8)!important}
#priceScale .pLabel{position:absolute;right:8px;transform:translateY(-50%);font-size:9px;font-weight:800;color:#fff;white-space:nowrap;background:transparent!important;box-shadow:none!important;border:none!important;text-shadow:0 0 6px rgba(255,255,255,.4)!important;padding:0!important;margin:0!important;filter:brightness(1.3)}
#priceScale .pLabel.major{color:#fff;filter:brightness(1.5)}
.pair-box{position:absolute;left:8px;bottom:28px;z-index:22;display:inline-flex;align-items:center;gap:6px;background:var(--bg-secondary);border:1.1px solid var(--border-secondary);border-radius:11px;padding:5px 10px;cursor:pointer;user-select:none}
.pair-box .flags{display:flex;align-items:center}
.pair-box .flags img{width:24px;height:24px;border-radius:999px;border:2px solid var(--bg-card);margin-left:-8px;background:var(--bg-card)}
.pair-box .otc{padding:2px 6px;border-radius:999px;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.18);font-size:11px;font-weight:900;letter-spacing:.4px}
.pairPanel{position:fixed;left:0;top:0;bottom:0;width:min(280px,85vw);background:rgba(10,22,40,.97);border-right:1.5px solid var(--border-primary);backdrop-filter:blur(12px);z-index:99998;transform:translateX(-105%);transition:transform .25s ease;box-shadow:4px 0 24px rgba(0,0,0,.6)}
.pairPanel.on{transform:translateX(0)}
.pairHead{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1.5px solid var(--border-primary);background:linear-gradient(to bottom,rgba(255,255,255,.03),transparent)}
.pairHead b{font-size:15px;font-weight:900;color:#fff;letter-spacing:.3px}
.pairClose{width:36px;height:36px;border-radius:11px;background:rgba(255,255,255,.08);border:1.5px solid var(--border-primary);color:rgba(255,255,255,.8);font-weight:900;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.pairList{padding:10px 12px;max-height:calc(100vh - 80px);overflow-y:auto}
.pit{width:100%;display:flex;align-items:center;justify-content:space-between;gap:11px;padding:11px 13px;border-radius:13px;background:rgba(255,255,255,.03);border:1.5px solid var(--border-primary);color:rgba(217,230,255,.9);margin:6px 0;cursor:pointer;transition:.2s}
.pit:hover{background:rgba(255,255,255,.06)}
.pitL{display:flex;align-items:center;gap:11px;min-width:0}
.star{width:20px;height:20px;border-radius:7px;background:rgba(255,159,42,.10);border:1px solid rgba(255,159,42,.30);display:grid;place-items:center;color:#ffb357;font-size:13px;flex-shrink:0}
.fg{display:flex;align-items:center}
.fg img{width:24px;height:24px;border-radius:999px;border:2px solid var(--bg-card);margin-left:-8px;background:var(--bg-card)}
.nm{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:900;color:#fff}
.bad{margin-inline-start:6px;padding:2px 6px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid var(--border-primary);font-size:11px;font-weight:900;color:rgba(217,230,255,.7)}
.controls{flex:0 0 auto;padding:9px 10.8px 0;background:#0f1d35}
.timer-amount{display:flex;gap:7.2px;margin-bottom:9px}
.control-group{flex:1;display:flex;flex-direction:column;gap:5.4px}
.control-label{font-size:9.9px;color:#8b9cb5;font-weight:600;text-align:center}
.control-value{background:#0a1628;padding:9px 14px;border-radius:9px;border:1px solid rgba(255,255,255,.2);font-size:16px;font-weight:700;display:flex;align-items:center;justify-content:center;gap:10px;cursor:pointer;position:relative;user-select:none;width:100%;min-height:46px;box-shadow:inset 0 2px 8px rgba(0,0,0,.4)}
.control-value:hover{background:#0d1a2e}
.control-text{flex:1;text-align:center}
.control-icon{width:18px;height:18px;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.dropdown{position:absolute;bottom:calc(100% + 7.2px);left:-9px;right:-9px;background:#1a2942;border-radius:10.8px;box-shadow:0 -3.6px 18px rgba(0,0,0,.6);z-index:200;display:none;border:1px solid rgba(255,255,255,.15);max-width:360px;width:auto;min-width:calc(100% + 18px)}
.dropdown.show{display:block}
.dropdown-header{display:flex;border-bottom:1px solid rgba(255,255,255,.1);padding:3.6px}
.dropdown-tab{flex:1;padding:9px 14.4px;text-align:center;font-size:10.8px;cursor:pointer;background:transparent;border:0;color:#8b9cb5;font-weight:700;border-radius:7.2px;transition:all .2s}
.dropdown-tab.active{color:#fff;background:rgba(59,130,246,.2)}
.dropdown-content{max-height:216px;overflow-y:auto;padding:5.4px;display:grid;grid-template-columns:repeat(3,1fr);gap:4px}
.dropdown-item{padding:10.8px 8px;font-size:12.6px;cursor:pointer;border-radius:7.2px;font-weight:600;transition:all .2s;text-align:center}
.dropdown-item:hover{background:rgba(59,130,246,.15);color:#3b82f6}
.custom-input{padding:7.2px 10.8px;display:none}
.custom-input.show{display:block}
.time-input{width:100%;background:#0f1d35;border:1px solid rgba(255,255,255,.2);border-radius:7.2px;padding:10.8px;color:#fff;font-size:14.4px;text-align:center;font-weight:700;letter-spacing:.9px}
#timeDisplay.editing{background:#0f1d35;border:1px solid rgba(59,130,246,.5);outline:none;cursor:text;color:#fff}
#amountDisplay{background:transparent;border:none;color:#fff;font-size:16px;text-align:center;font-weight:700;outline:none;width:100%;cursor:text;padding:0}
#amountDisplay:focus{outline:none}
.trade-buttons{display:flex;gap:7.2px;margin:9px 0 5.4px}
.trade-btn{flex:1;height:38px;border:0;border-radius:10.8px;font-size:13.5px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7.2px;transition:transform .2s}
.trade-btn:active{transform:scale(.96)}
.buy-btn{background:linear-gradient(135deg,#0f0,#0c0);color:#fff}
.buy-btn:before{content:"‚Üó";font-size:16.2px}
.sell-btn{background:linear-gradient(135deg,#f00,#c00);color:#fff}
.sell-btn:before{content:"‚Üò";font-size:16.2px}
.ai-trade-btn{flex:2;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}
.ai-trade-btn:before{content:"AI";margin-right:4.5px;font-weight:900}
.bottom-nav{flex:0 0 auto;background:#0f1d35;display:flex;justify-content:space-around;padding:7.2px 0;border-top:1px solid rgba(255,255,255,.05)}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:3.6px;color:#6b7a94;font-size:9px;cursor:pointer}
.nav-item.active{color:#3b82f6}
.nav-icon{width:21.6px;height:21.6px;display:flex;align-items:center;justify-content:center;font-size:16.2px}
.active-trades-panel{position:absolute;top:10px;right:58px;z-index:185;display:flex;flex-direction:column;gap:5px;pointer-events:none;max-width:170px}
.trade-card{background:rgba(10,22,40,.93);border-radius:8px;padding:7px 10px;border:1px solid rgba(255,255,255,.1);border-left:3px solid;pointer-events:auto;backdrop-filter:blur(6px);min-width:155px}
.buy-card{border-left-color:#00cc00}
.sell-card{border-left-color:#ff3333}
.tc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.tc-type{font-size:9px;font-weight:900;padding:2px 6px;border-radius:4px;letter-spacing:.3px}
.tc-type.buy{background:rgba(0,204,0,.2);color:#00cc00}
.tc-type.sell{background:rgba(255,51,51,.2);color:#ff3333}
.tc-timer{font-size:11px;font-weight:900;font-family:monospace;color:#ffd700;letter-spacing:.5px}
.tc-row{display:flex;justify-content:space-between;font-size:9px;margin-top:2px}
.tc-row span:first-child{color:#8b9cb5}
.tc-row span:last-child{color:#e0e0e0;font-weight:700}
.tc-pnl{font-size:11px;font-weight:900;text-align:right;margin-top:4px;padding-top:3px;border-top:1px solid rgba(255,255,255,.07)}
.tc-win{color:#00cc00}
.tc-lose{color:#ff3333}
.history-panel{position:fixed;inset:0;background:#0a1628;z-index:400;transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;overflow:hidden}
.history-panel.show{transform:translateY(0)}
.history-header{flex:0 0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:#0f1d35;border-bottom:1px solid rgba(255,255,255,.08)}
.history-title{font-size:13px;font-weight:900;color:#fff}
.history-close-btn{background:rgba(255,255,255,.08);border:none;color:#fff;font-size:18px;width:30px;height:30px;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.history-stats{flex:0 0 auto;display:flex;background:#0f1d35;border-bottom:1px solid rgba(255,255,255,.06)}
.hstat{flex:1;padding:8px 4px;text-align:center;border-right:1px solid rgba(255,255,255,.05)}
.hstat:last-child{border-right:none}
.hstat-label{font-size:8px;color:#8b9cb5;margin-bottom:2px}
.hstat-value{font-size:13px;font-weight:900}
.history-tabs{flex:0 0 auto;display:flex;padding:6px 8px;gap:5px;background:#0f1d35;border-bottom:1px solid rgba(255,255,255,.05)}
.htab{flex:1;padding:6px 8px;background:transparent;border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#8b9cb5;font-size:10px;font-weight:700;cursor:pointer;transition:all .2s}
.htab.active{background:rgba(59,130,246,.2);border-color:rgba(59,130,246,.4);color:#fff}
#historyContent{flex:1;overflow-y:auto;padding:8px;-webkit-overflow-scrolling:touch}
.trade-record{background:#0f1d35;border-radius:10px;padding:10px 12px;margin-bottom:8px;border:1px solid rgba(255,255,255,.08)}
.tr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.tr-badge{display:flex;align-items:center;gap:6px}
.tr-type{font-size:10px;font-weight:900;padding:2px 8px;border-radius:4px}
.tr-type.buy{background:rgba(0,204,0,.15);color:#00cc00;border:1px solid rgba(0,204,0,.3)}
.tr-type.sell{background:rgba(255,51,51,.15);color:#ff5555;border:1px solid rgba(255,51,51,.3)}
.tr-status{font-size:9px;padding:2px 6px;border-radius:4px;font-weight:700}
.tr-status.won{background:rgba(0,204,0,.15);color:#00cc00}
.tr-status.lost{background:rgba(255,51,51,.15);color:#ff5555}
.tr-status.active{background:rgba(255,215,0,.15);color:#ffd700}
.tr-pnl{font-size:14px;font-weight:900}
.tr-pnl.win{color:#00cc00}
.tr-pnl.loss{color:#ff5555}
.tr-pnl.active-pnl{color:#ffd700}
.tr-details{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.tr-detail{display:flex;flex-direction:column;gap:2px}
.tr-detail-label{font-size:8px;color:#8b9cb5;font-weight:600}
.tr-detail-value{font-size:9.5px;font-weight:700;color:#fff}
.loading-text,.empty-history{text-align:center;color:#8b9cb5;padding:40px 20px;font-size:12px}
.result-toast{position:fixed;bottom:85px;left:50%;transform:translateX(-50%) translateY(150px);background:#0f1d35;border-radius:14px;padding:14px 24px;z-index:500;transition:transform .35s cubic-bezier(.34,1.56,.64,1),opacity .35s;border:2px solid transparent;min-width:220px;text-align:center;opacity:0;pointer-events:none}
.result-toast.show{transform:translateX(-50%) translateY(0);opacity:1;pointer-events:auto}
.result-toast.win{border-color:#00cc00;box-shadow:0 0 25px rgba(0,204,0,.3)}
.result-toast.lose{border-color:#ff3333;box-shadow:0 0 25px rgba(255,51,51,.3)}
.toast-emoji{font-size:26px;margin-bottom:4px;display:block}
.toast-title{font-size:13px;font-weight:900;color:#fff;margin-bottom:4px}
.toast-amount{font-size:20px;font-weight:900;margin-bottom:4px}
.toast-price{font-size:9px;color:#8b9cb5}
.info-toast{position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-80px);background:#1a2942;border:1px solid rgba(255,255,255,.15);border-radius:8px;padding:8px 16px;z-index:500;transition:transform .3s ease,opacity .3s;font-size:11px;font-weight:700;color:#fff;opacity:0;pointer-events:none;white-space:nowrap;direction:rtl}
.info-toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.info-toast.buy{border-color:rgba(0,204,0,.5)}
.info-toast.sell{border-color:rgba(255,51,51,.5)}
.info-toast.error{border-color:rgba(255,200,0,.5);background:#1a1a2e}
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="balance" id="balanceBox">
      <div class="balanceMain">
        <img class="flag-icon" id="topAccIcon" src="https://cdn-icons-png.flaticon.com/128/1344/1344761.png">
        <span class="balance-amount" id="balanceAmount">$10,000.00</span>
      </div>
      <svg class="arrow-down" viewBox="0 0 24 24" fill="#888"><path d="M7 10l5 5 5-5z"/></svg>

      <!-- ‚ïê‚ïê ACCOUNT MENU ‚ïê‚ïê -->
      <div class="accMenu" id="accMenu">

        <!-- ÿ≠ÿ≥ÿßÿ® ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä -->
        <div class="accItem active" id="accItemDemo">
          <div class="accL">
            <div class="accCircle sel" id="circleDemo"></div>
            <div style="flex:1;min-width:0">
              <div style="font-size:9px;color:#8b9cb5;margin-bottom:1px">ÿ≠ÿ≥ÿßÿ® ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä</div>
              <div class="accAmt" id="demoAmt">$10,000.00</div>
            </div>
          </div>
          <span style="font-size:9px;font-weight:800;color:#ffd700;background:rgba(255,215,0,.1);padding:2px 7px;border-radius:5px;border:1px solid rgba(255,215,0,.25);white-space:nowrap">Demo USD</span>
        </div>

        <!-- ÿµŸÅ ÿ™ÿ®ÿØŸäŸÑ + ÿ™ÿπÿ®ÿ¶ÿ© (ŸÑŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä ŸÅŸÇÿ∑) -->
        <div class="refillRow" id="refillRow">
          <button class="switchBtn" id="switchAccBtn">‚áÑ ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™</button>
          <button class="refillBtnEl" id="refillBtn">üîÑ ÿ™ÿπÿ®ÿ¶ÿ© $10,000</button>
        </div>

        <!-- ÿ≠ÿ≥ÿßÿ® ÿ≠ŸÇŸäŸÇŸä -->
        <div class="accItem" id="accItemReal">
          <div class="accL">
            <div class="accCircle" id="circleReal"></div>
            <div style="flex:1;min-width:0">
              <div style="font-size:9px;color:#8b9cb5;margin-bottom:1px">ÿ≠ÿ≥ÿßÿ® ÿ≠ŸÇŸäŸÇŸä</div>
              <div class="accAmt" id="realAmt">$0.00</div>
            </div>
          </div>
          <img class="accIco" src="https://flagcdn.com/w40/us.png">
        </div>

      </div><!-- /accMenu -->
    </div>
  </div>

  <div class="header-center">
    <button class="wallet-btn" aria-label="Wallet">
      <img src="https://cdn-icons-png.flaticon.com/128/10167/10167706.png" alt="Wallet">
    </button>
    <button class="icon-btn logo-btn" aria-label="QT">
      <img src="https://cdn-icons-png.flaticon.com/128/18921/18921105.png" alt="QT">
    </button>
  </div>
  <div class="time-display" id="liveTime">00:00:00 UTC+3</div>
</div>

<!-- CHART -->
<div class="chart-container">
  <div class="quick-actions">
    <button class="qa-btn" id="historyNavBtn" aria-label="Trade History">
      <svg width="42" height="42" viewBox="0 0 24 24" fill="none">
        <defs><linearGradient id="gradBag" x1="0" y1="0" x2="24" y2="24"><stop offset="0%" stop-color="#4a90e2"/><stop offset="100%" stop-color="#357abd"/></linearGradient></defs>
        <rect x="3" y="7" width="18" height="13" rx="3" stroke="url(#gradBag)" stroke-width="2" fill="none"/>
        <path d="M8 7V5a4 4 0 0 1 8 0v2" stroke="url(#gradBag)" stroke-width="2" stroke-linecap="round"/>
        <line x1="7" y1="12" x2="17" y2="12" stroke="url(#gradBag)" stroke-width="1.6" stroke-linecap="round"/>
      </svg>
    </button>
    <button class="qa-btn" aria-label="Options" style="color:#4a90e2">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <line x1="5" y1="7" x2="19" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="5" y1="17" x2="19" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <div class="active-trades-panel" id="activeTradesPanel" style="display:none"></div>

  <div class="chart-frame">
    <div class="plot" id="plot">
      <canvas id="chartCanvas"></canvas>
      <div class="price-line" id="priceLine"></div>
      <div class="candle-timer" id="candleTimer">59</div>
      <div id="priceScale">
        <div id="priceScaleLabels"></div>
        <div id="currentPrice"></div>
      </div>
      <div class="timeLabels" id="timeLabels"></div>
      <div class="pair-box" id="pairHud">
        <div class="flags" id="pairFlags"></div>
        <span id="pairHudTxt">EUR/USD</span>
        <span class="otc">OTC</span>
        <span style="opacity:.7">‚ñæ</span>
      </div>
    </div>
  </div>
</div>

<!-- PAIR PANEL -->
<div class="pairPanel" id="pairPanel">
  <div class="pairHead">
    <b>ÿßŸÑÿ£ÿ≤Ÿàÿßÿ¨</b>
    <button class="pairClose" id="pairClose">√ó</button>
  </div>
  <div class="pairList" id="pairList"></div>
</div>

<!-- CONTROLS -->
<div class="controls">
  <div class="timer-amount">
    <div class="control-group">
      <div class="control-label">Time</div>
      <div class="control-value" id="timeSelector">
        <span class="control-text" id="timeDisplay">00:05</span>
        <div class="control-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg>
        </div>
        <div class="dropdown" id="timeDropdown">
          <div class="dropdown-header">
            <button class="dropdown-tab active" id="tabCompensation">Quick</button>
            <button class="dropdown-tab" id="tabCustom">Custom</button>
          </div>
          <div class="dropdown-content" id="compensationList">
            <div class="dropdown-item" data-sec="5">00:05</div>
            <div class="dropdown-item" data-sec="10">00:10</div>
            <div class="dropdown-item" data-sec="15">00:15</div>
            <div class="dropdown-item" data-sec="30">00:30</div>
            <div class="dropdown-item" data-sec="60">01:00</div>
            <div class="dropdown-item" data-sec="120">02:00</div>
            <div class="dropdown-item" data-sec="300">05:00</div>
            <div class="dropdown-item" data-sec="600">10:00</div>
            <div class="dropdown-item" data-sec="900">15:00</div>
            <div class="dropdown-item" data-sec="1800">30:00</div>
            <div class="dropdown-item" data-sec="3600">01:00:00</div>
            <div class="dropdown-item" data-sec="7200">02:00:00</div>
          </div>
        </div>
      </div>
    </div>
    <div class="control-group">
      <div class="control-label">Amount</div>
      <div class="control-value" id="amountContainer">
        <input type="text" class="control-text" id="amountDisplay" value="50$">
        <div class="control-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M12 6v12"/><path d="M15 9.5c0-1.4-1.3-2.5-3-2.5s-3 1.1-3 2.5 1.3 2.5 3 2.5 3 1.1 3 2.5-1.3 2.5-3 2.5-3-1.1-3-2.5"/></svg>
        </div>
      </div>
    </div>
  </div>
  <div class="trade-buttons">
    <button class="trade-btn buy-btn" id="buyBtn">BUY</button>
    <button class="trade-btn ai-trade-btn">TRADING</button>
    <button class="trade-btn sell-btn" id="sellBtn">SELL</button>
  </div>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <div class="nav-item active" id="navChart">
    <div class="nav-icon">
      <svg width="21.6" height="21.6" viewBox="0 0 24 24" fill="none"><rect x="2" y="2" width="20" height="20" rx="2" ry="2" stroke="currentColor" stroke-width="1.5" fill="none"/><line x1="4" y1="20" x2="20" y2="20" stroke="currentColor" stroke-width=".8"/><line x1="4" y1="4" x2="4" y2="20" stroke="currentColor" stroke-width=".8"/><polyline points="4,16 8,12 12,14 16,8 20,10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="4" cy="16" r="1.2" fill="currentColor"/><circle cx="8" cy="12" r="1.2" fill="currentColor"/><circle cx="12" cy="14" r="1.2" fill="currentColor"/><circle cx="16" cy="8" r="1.2" fill="currentColor"/><circle cx="20" cy="10" r="1.2" fill="currentColor"/></svg>
    </div>
    <div>Chart</div>
  </div>
  <div class="nav-item" id="navHistory">
    <div class="nav-icon">
      <svg width="21.6" height="21.6" viewBox="0 0 24 24" fill="none"><rect x="3" y="7" width="18" height="14" rx="2" ry="2" fill="currentColor"/><rect x="8" y="3" width="8" height="4" rx="1" ry="1" fill="currentColor"/><line x1="6" y1="11" x2="18" y2="11" stroke="#0a1628" stroke-width="1"/><line x1="6" y1="14" x2="18" y2="14" stroke="#0a1628" stroke-width="1"/><line x1="6" y1="17" x2="18" y2="17" stroke="#0a1628" stroke-width="1"/></svg>
    </div>
    <div>History</div>
  </div>
  <!-- Profile nav - ŸäÿØÿπŸÖ ÿßŸÑÿ£ŸÅÿßÿ™ÿßÿ± -->
  <div class="nav-item" id="navProfile">
    <div class="nav-icon" style="position:relative">
      <svg id="profileNavSvg" width="21.6" height="21.6" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="11" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="12" cy="8" r="3" fill="currentColor"/><path d="M6 20c0-3.3 5-5 6-5s6 1.7 6 5" fill="currentColor"/></svg>
      <img id="profileNavImg" class="nav-avatar" style="display:none;position:absolute;inset:0;width:100%;height:100%" src="" alt="avatar">
    </div>
    <div>Profile</div>
  </div>
  <div class="nav-item">
    <div class="nav-icon">
      <svg width="21.6" height="21.6" viewBox="0 0 24 24" fill="none"><rect x="2" y="2" width="20" height="20" rx="3" ry="3" stroke="currentColor" stroke-width="1.5" fill="none"/><rect x="8" y="18" width="8" height="2" fill="currentColor"/><rect x="11" y="10" width="2" height="8" fill="currentColor"/><path d="M6 10 C6 6, 18 6, 18 10 C18 14, 6 14, 6 10 Z" fill="currentColor"/><path d="M6 10 C4 10, 4 12, 6 12" stroke="currentColor" stroke-width="1.5" fill="none"/><path d="M18 10 C20 10, 20 12, 18 12" stroke="currentColor" stroke-width="1.5" fill="none"/></svg>
    </div>
    <div>Rank</div>
  </div>
  <div class="nav-item">
    <div class="nav-icon">
      <svg width="21.6" height="21.6" viewBox="0 0 24 24" fill="none"><rect x="2" y="2" width="20" height="20" rx="3" ry="3" stroke="currentColor" stroke-width="1.5" fill="none"/><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2" fill="currentColor"/><line x1="12" y1="2" x2="12" y2="5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="12" y1="19" x2="12" y2="22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="2" y1="12" x2="5" y2="12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="19" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="5" y1="5" x2="7" y2="7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="17" y1="17" x2="19" y2="19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="5" y1="19" x2="7" y2="17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><line x1="17" y1="7" x2="19" y2="5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    </div>
    <div>Settings</div>
  </div>
</div>

<!-- HISTORY PANEL -->
<div class="history-panel" id="historyPanel">
  <div class="history-header">
    <div class="history-title">üìä ÿ≥ÿ¨ŸÑ ÿßŸÑÿµŸÅŸÇÿßÿ™</div>
    <button class="history-close-btn" id="historyCloseBtn">‚úï</button>
  </div>
  <div class="history-stats" id="historyStats">
    <div class="hstat"><div class="hstat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä</div><div class="hstat-value" id="statTotal" style="color:#fff">0</div></div>
    <div class="hstat"><div class="hstat-label">ÿ±ÿ®ÿ≠</div><div class="hstat-value" id="statWon" style="color:#00cc00">0</div></div>
    <div class="hstat"><div class="hstat-label">ÿÆÿ≥ÿßÿ±ÿ©</div><div class="hstat-value" id="statLost" style="color:#ff5555">0</div></div>
    <div class="hstat"><div class="hstat-label">ÿµÿßŸÅŸä ÿßŸÑÿ±ÿ®ÿ≠</div><div class="hstat-value" id="statPnl" style="color:#ffd700">$0</div></div>
  </div>
  <div class="history-tabs">
    <button class="htab active" data-tab="all">ÿßŸÑŸÉŸÑ</button>
    <button class="htab" data-tab="active">ŸÜÿ¥ÿ∑ÿ©</button>
    <button class="htab" data-tab="closed">ŸÖÿ∫ŸÑŸÇÿ©</button>
  </div>
  <div id="historyContent"><div class="empty-history">ÿßŸÅÿ™ÿ≠ ÿßŸÑÿµŸÅŸÇÿ© ÿßŸÑÿ£ŸàŸÑŸâ ŸÑÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß!</div></div>
</div>

<div class="result-toast" id="resultToast"></div>
<div class="info-toast" id="infoToast"></div>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="script.js"></script>

<!-- ‚ïê‚ïê PAIR PANEL JS ‚ïê‚ïê -->
<script>
(function(){
  const fM={AED:"ae",CNY:"cn",AUD:"au",CAD:"ca",CHF:"ch",BHD:"bh",EUR:"eu",RUB:"ru",USD:"us",KES:"ke",LBP:"lb",QAR:"qa",TRY:"tr",SYP:"sy",EGP:"eg",INR:"in"};
  const mkF=c=>`https://flagcdn.com/w40/${(fM[c]||"un").toLowerCase()}.png`;
  const dP=[
    {pair:"EUR/USD",flags:["EUR","USD"],payout:.92},{pair:"AUD/CAD",flags:["AUD","CAD"],payout:.88},
    {pair:"AUD/CHF",flags:["AUD","CHF"],payout:.92},{pair:"USD/CHF",flags:["USD","CHF"],payout:.89},
    {pair:"EUR/RUB",flags:["EUR","RUB"],payout:.77},{pair:"AED/CNY",flags:["AED","CNY"],payout:.91},
    {pair:"BHD/CNY",flags:["BHD","CNY"],payout:.86},{pair:"KES/USD",flags:["KES","USD"],payout:.84},
    {pair:"LBP/USD",flags:["LBP","USD"],payout:.79},{pair:"QAR/CNY",flags:["QAR","CNY"],payout:.83},
    {pair:"SYP/TRY",flags:["SYP","TRY"],payout:.87},{pair:"EGP/USD",flags:["EGP","USD"],payout:.78},
    {pair:"USD/INR",flags:["USD","INR"],payout:.90}
  ];
  const favs=new Set,fP=v=>Math.round(v*100)+"%";
  function upPairHud(p){
    const m=dP.find(x=>x.pair===p)||dP[0];
    const pf=document.getElementById("pairFlags"),pt=document.getElementById("pairHudTxt");
    if(pf)pf.innerHTML=m.flags.map(f=>`<img src="${mkF(f)}" alt="${f}">`).join("");
    if(pt)pt.textContent=p;
  }
  function rPP(){
    const pl=document.getElementById("pairList");if(!pl)return;
    const s=[...dP].sort((a,b)=>{const fa=favs.has(a.pair)?1:0,fb=favs.has(b.pair)?1:0;return fa!==fb?fb-fa:a.pair.localeCompare(b.pair);});
    pl.innerHTML=s.map(x=>`<button class="pit" data-p="${x.pair}"><span class="pitL"><span class="star" data-s="1">${favs.has(x.pair)?"‚òÖ":"‚òÜ"}</span><span class="fg">${x.flags.map(f=>`<img src="${mkF(f)}" alt="${f}">`).join("")}</span><span class="nm">${x.pair}<span class="bad">OTC</span></span></span><span style="font-size:11px;font-weight:900;color:#00cc00">+${fP(x.payout)}</span></button>`).join("");
  }
  const pH=document.getElementById("pairHud"),pP=document.getElementById("pairPanel"),pC=document.getElementById("pairClose"),pL=document.getElementById("pairList");
  if(pH)pH.onclick=e=>{e.stopPropagation();pP.classList.toggle("on");rPP()};
  if(pC)pC.onclick=()=>pP.classList.remove("on");
  if(pL)pL.onclick=async e=>{
    const b=e.target.closest("button.pit");if(!b)return;
    const p=b.getAttribute("data-p");
    if(e.target.dataset.s){favs.has(p)?favs.delete(p):favs.add(p);rPP();return;}
    pP.classList.remove("on");upPairHud(p);
    if(window.chart&&window.chart.switchPair)await window.chart.switchPair(p);
  };
  document.addEventListener("click",e=>{if(pP&&pP.classList.contains("on")&&!e.target.closest("#pairPanel")&&!e.target.closest("#pairHud"))pP.classList.remove("on");});
  upPairHud("EUR/USD");
})();
</script>

<!-- ‚ïê‚ïê ACCOUNT MANAGER + FIREBASE FIELDS + AVATAR + BALANCE CHECK ‚ïê‚ïê -->
<script>
(function(){
  /* ‚îÄ‚îÄ ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™ŸáŸäÿ¶ÿ© Firebase ‚îÄ‚îÄ */
  function waitFB(cb,n=0){
    if(typeof firebase!=='undefined'&&firebase.apps&&firebase.apps.length)cb();
    else if(n<60)setTimeout(()=>waitFB(cb,n+1),100);
    else console.warn("Firebase not initialized");
  }

  /* ‚îÄ‚îÄ toast ŸÖÿ≥ÿßÿπÿØ ‚îÄ‚îÄ */
  function toast(msg,type,dur=2600){
    const t=document.getElementById('infoToast');
    if(!t)return;
    t.textContent=msg;
    t.className='info-toast show '+(type||'');
    clearTimeout(t._t);
    t._t=setTimeout(()=>t.classList.remove('show'),dur);
  }

  /* ‚îÄ‚îÄ ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ±ŸÇŸÖ ‚îÄ‚îÄ */
  const fmt=v=>'$'+Number(v).toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2});

  waitFB(function(){
    const auth=firebase.auth(),db=firebase.firestore();
    let uid=null,unsub=null;

    /* ‚îÄ‚îÄ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿØÿßÿÆŸÑŸäÿ© ‚îÄ‚îÄ */
    window._curAcc=localStorage.getItem('_curAcc')||'demo';
    window._demoBalance=10000;
    window._realBalance=0;

    /* ‚îÄ‚îÄ ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿµŸäÿØ ‚îÄ‚îÄ */
    function refreshUI(){
      const ac=window._curAcc,db_=window._demoBalance,rb=window._realBalance;
      const cur=ac==='demo'?db_:rb;
      document.getElementById('balanceAmount').textContent=fmt(cur);
      document.getElementById('demoAmt').textContent=fmt(db_);
      document.getElementById('realAmt').textContent=fmt(rb);
      /* ÿØŸàÿßÿ¶ÿ± ÿßŸÑÿ±ÿßÿØŸäŸà */
      document.getElementById('circleDemo').classList.toggle('sel',ac==='demo');
      document.getElementById('circleReal').classList.toggle('sel',ac==='real');
      /* ÿ™ÿ∏ŸÑŸäŸÑ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÜÿ¥ÿ∑ */
      document.getElementById('accItemDemo').classList.toggle('active',ac==='demo');
      document.getElementById('accItemReal').classList.toggle('active',ac==='real');
      /* ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿπŸÑŸàŸäÿ© */
      document.getElementById('topAccIcon').src=ac==='demo'
        ?'https://cdn-icons-png.flaticon.com/128/1344/1344761.png'
        :'https://flagcdn.com/w40/us.png';
      /* ÿµŸÅ ÿßŸÑÿ™ÿπÿ®ÿ¶ÿ©: Ÿäÿ∏Ÿáÿ± ŸÅŸÇÿ∑ ŸÖÿπ ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä */
      document.getElementById('refillRow').style.display=ac==='demo'?'flex':'none';
    }

    /* ‚îÄ‚îÄ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ŸÅÿßÿ™ÿßÿ± ‚îÄ‚îÄ */
    function setAvatar(url){
      const img=document.getElementById('profileNavImg'),svg=document.getElementById('profileNavSvg');
      if(url&&url.startsWith('http')){
        img.src=url;img.style.display='block';
        if(svg)svg.style.display='none';
      }else{
        img.style.display='none';
        if(svg)svg.style.display='block';
      }
    }

    /* ‚îÄ‚îÄ ÿ•ŸÜÿ¥ÿßÿ°/ÿ™ÿ≠ŸÇŸÇ ÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ‚îÄ‚îÄ */
    async function initFields(userId){
      const ref=db.collection('users').doc(userId);
      const snap=await ref.get();
      const d=snap.exists?snap.data():{};
      const up={};
      if(d.demoBalance===undefined)up.demoBalance=10000;
      if(d.realBalance===undefined)up.realBalance=0;
      if(d.avatar===undefined)up.avatar='';
      if(Object.keys(up).length)await ref.set(up,{merge:true});
    }

    /* ‚îÄ‚îÄ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿßŸÑŸÅŸàÿ±Ÿä ŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ‚îÄ‚îÄ */
    function listenUser(userId){
      if(unsub)unsub();
      unsub=db.collection('users').doc(userId).onSnapshot(snap=>{
        if(!snap.exists)return;
        const d=snap.data();
        if(typeof d.demoBalance==='number')window._demoBalance=d.demoBalance;
        if(typeof d.realBalance==='number')window._realBalance=d.realBalance;
        refreshUI();
        setAvatar(d.avatar||'');
      });
    }

    /* ‚îÄ‚îÄ ÿπŸÜÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ‚îÄ‚îÄ */
    auth.onAuthStateChanged(async user=>{
      if(user){
        uid=user.uid;
        await initFields(uid);
        listenUser(uid);
        /* ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿµŸàÿ±ÿ© ŸÅŸä Firebase Auth ‚îÄ‚îÄ */
        if(user.photoURL)setAvatar(user.photoURL);
      }else{
        uid=null;if(unsub)unsub();
        window._demoBalance=10000;window._realBalance=0;
        refreshUI();setAvatar('');
      }
    });

    /* ‚îÄ‚îÄ ŸÅÿ™ÿ≠/ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ‚îÄ‚îÄ */
    const box=document.getElementById('balanceBox'),menu=document.getElementById('accMenu');
    box.addEventListener('click',function(e){
      if(e.target.closest('.accMenu'))return;
      e.stopPropagation();
      menu.classList.toggle('show');
      box.classList.toggle('open');
    });
    document.addEventListener('click',e=>{
      if(!e.target.closest('#balanceBox')){
        menu.classList.remove('show');
        box.classList.remove('open');
      }
    });

    /* ‚îÄ‚îÄ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä ‚îÄ‚îÄ */
    document.getElementById('accItemDemo').addEventListener('click',e=>{
      if(e.target.closest('#refillRow'))return;
      window._curAcc='demo';localStorage.setItem('_curAcc','demo');
      refreshUI();menu.classList.remove('show');box.classList.remove('open');
    });

    /* ‚îÄ‚îÄ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≠ŸÇŸäŸÇŸä ‚îÄ‚îÄ */
    document.getElementById('accItemReal').addEventListener('click',()=>{
      window._curAcc='real';localStorage.setItem('_curAcc','real');
      refreshUI();menu.classList.remove('show');box.classList.remove('open');
    });

    /* ‚îÄ‚îÄ ÿ≤ÿ± ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™ ‚îÄ‚îÄ */
    document.getElementById('switchAccBtn').addEventListener('click',e=>{
      e.stopPropagation();
      window._curAcc=window._curAcc==='demo'?'real':'demo';
      localStorage.setItem('_curAcc',window._curAcc);
      refreshUI();
      toast(window._curAcc==='demo'?'‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä':'‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≠ŸÇŸäŸÇŸä');
    });

    /* ‚îÄ‚îÄ ÿ≤ÿ± ÿ™ÿπÿ®ÿ¶ÿ© ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä ‚îÄ‚îÄ */
    document.getElementById('refillBtn').addEventListener('click',async e=>{
      e.stopPropagation();
      if(!uid){toast('‚ùå Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã','error');return;}
      await db.collection('users').doc(uid).update({demoBalance:10000});
      window._demoBalance=10000;refreshUI();
      toast('‚úÖ ÿ™ŸÖ ÿ™ÿπÿ®ÿ¶ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä ÿ®ŸÄ $10,000');
    });

    /* ‚îÄ‚îÄ ŸÖŸÜÿπ ÿßŸÑÿµŸÅŸÇÿßÿ™ ÿ®ÿ≠ÿ≥ÿßÿ® ŸÅÿßÿ±ÿ∫ (capture phase) ‚îÄ‚îÄ */
    document.addEventListener('click',e=>{
      const bb=document.getElementById('buyBtn'),sb=document.getElementById('sellBtn');
      if(e.target!==bb&&e.target!==sb)return;
      const bal=window._curAcc==='demo'?window._demoBalance:window._realBalance;
      const amt=parseFloat((document.getElementById('amountDisplay').value||'0').replace(/[^0-9.]/g,''))||0;
      if(bal<=0){
        e.stopImmediatePropagation();
        toast('‚ùå ÿßŸÑÿ±ÿµŸäÿØ ŸÅÿßÿ±ÿ∫! ŸÇŸÖ ÿ®ÿ™ÿπÿ®ÿ¶ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ£ŸàŸÑÿßŸã','error');
        return;
      }
      if(amt>bal){
        e.stopImmediatePropagation();
        toast('‚ùå ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿ±ÿµŸäÿØŸÉ ÿßŸÑŸÖÿ™ÿßÿ≠!','error');
      }
    },true);

    /* ‚îÄ‚îÄ ÿØŸàÿßŸÑ ÿπÿßŸÑŸÖŸäÿ© ŸÑŸÄ script.js ‚îÄ‚îÄ */
    window.getCurrentBalance=()=>window._curAcc==='demo'?window._demoBalance:window._realBalance;
    window.getCurrentAccount=()=>window._curAcc;
    window.deductBalance=async amt=>{
      if(!uid)return;
      const f=window._curAcc==='demo'?'demoBalance':'realBalance';
      const cur=window._curAcc==='demo'?window._demoBalance:window._realBalance;
      const nv=Math.max(0,cur-amt);
      await db.collection('users').doc(uid).update({[f]:nv});
    };
    window.addBalance=async amt=>{
      if(!uid)return;
      const f=window._curAcc==='demo'?'demoBalance':'realBalance';
      const cur=window._curAcc==='demo'?window._demoBalance:window._realBalance;
      await db.collection('users').doc(uid).update({[f]:cur+amt});
    };
    window.setUserAvatar=async url=>{
      if(!uid)return;
      await db.collection('users').doc(uid).update({avatar:url});
    };

    refreshUI();
  });
})();
</script>
</body>
</html>
